{% extends "base.html" %}

{% block content %}
<h1>{{ page_title }}</h1>

<div class="info-grid">
    <div class="info-card">
        <div class="info-label">Page Type</div>
        <div class="info-value">{{ page_type }}</div>
    </div>
    <div class="info-card">
        <div class="info-label">Page URL</div>
        <div class="info-value" style="word-break: break-all;">{{ page_url }}</div>
    </div>
    <div class="info-card">
        <div class="info-label">Overall Score</div>
        <div class="info-value {% if page_analysis.overall_score >= 8 %}good{% elif page_analysis.overall_score >= 6 %}average{% else %}poor{% endif %}">
            {{ page_analysis.overall_score }}/10
        </div>
    </div>
    <div class="info-card">
        <div class="info-label">Analysis Date</div>
        <div class="info-value">{{ analysis_date }}</div>
    </div>
</div>

<!-- Page Summary -->
<div class="section">
    <h2>Page Summary</h2>
    <div class="analysis-result">
        <p style="font-size: 1.1em; line-height: 1.7; background-color: #f0fdf4; padding: 15px; border-radius: 6px; border-left: 4px solid #10b981;">
            {{ page_analysis.summary }}
        </p>
    </div>
</div>

<!-- Tab navigation -->
<div class="tabs">
    <div class="tab active" data-tab="tab-detailed">Detailed Analysis</div>
    <div class="tab" data-tab="tab-issues">Key Issues</div>
    <div class="tab" data-tab="tab-recommendations">Recommendations</div>
    <div class="tab" data-tab="tab-raw">Raw Analysis</div>
</div>

<!-- Detailed Analysis Tab -->
<div id="tab-detailed" class="tab-content active">
    <div class="section">
        <h2>Comprehensive Page Analysis</h2>
        {% if page_analysis.cleaned_analysis %}
        <div class="detailed-analysis-content">
            {{ page_analysis.cleaned_analysis | safe }}
        </div>
        {% else %}
        <p>No detailed analysis available for this page.</p>
        {% endif %}
    </div>
</div>

<!-- Key Issues Tab -->
<div id="tab-issues" class="tab-content">
    {% if page_analysis.key_issues and page_analysis.key_issues.length > 0 %}
    <div class="section">
        <h2>Key Issues Identified</h2>
        {% for issue in page_analysis.key_issues %}
        <div class="critical-issue" style="margin-bottom: 15px;">
            <strong>{{ loop.index }}.</strong> {{ issue }}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="section">
        <div style="padding: 20px; background-color: #f0fdf4; border-radius: 6px; border-left: 4px solid #10b981;">
            <p><strong>✅ No critical issues identified</strong></p>
            <p>This page appears to be functioning well without major usability or conversion problems.</p>
        </div>
    </div>
    {% endif %}
</div>

<!-- Recommendations Tab -->
<div id="tab-recommendations" class="tab-content">
    {% if page_analysis.recommendations and page_analysis.recommendations.length > 0 %}
    <div class="section">
        <h2>Recommended Improvements</h2>
        {% for recommendation in page_analysis.recommendations %}
        <div class="recommendation" style="margin-bottom: 15px;">
            <strong>{{ loop.index }}.</strong> {{ recommendation }}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="section">
        <p>No specific recommendations were provided for this page.</p>
    </div>
    {% endif %}
</div>

<!-- Raw Analysis Tab -->
<div id="tab-raw" class="tab-content">
    <div class="section">
        <h2>Complete Raw Analysis Data</h2>
        {% if page_analysis.original_analysis %}
        <div class="analysis-result">
            <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f8f9fa; padding: 20px; border-radius: 6px; border: 1px solid #e9ecef; font-size: 0.9em; line-height: 1.4;">{{ page_analysis.original_analysis }}</pre>
        </div>
        {% else %}
        <p>No raw analysis data available for this page.</p>
        {% endif %}
    </div>
</div>

<!-- Screenshot - Moved to bottom -->
<div class="section">
    <h2>Page Screenshot</h2>
    <div class="screenshot-container">
        <img src="screenshots/desktop/{{ screenshot_path }}" alt="{{ page_type }}" class="screenshot" 
             style="max-width: 100%; border: 2px solid #e2e8f0; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"
             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
        <div style="display: none; padding: 20px; background-color: #f3f4f6; border-radius: 8px; text-align: center; color: #6b7280;">
            Screenshot not available: {{ screenshot_path }}
        </div>
    </div>
</div>

<div class="navigation" style="margin-top: 30px;">
    <a href="overview.html">← Back to Overview</a>
</div>

<style>
.detailed-analysis-content {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    line-height: 1.6;
    color: #334155;
}

.page-role-section {
    background-color: #f8fafc;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #3b82f6;
    margin-bottom: 30px;
}

.page-role-section h3 {
    color: #1e293b;
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 1.3em;
    font-weight: 600;
}

.page-role-content p {
    margin-bottom: 10px;
    color: #475569;
}

.analysis-main {
    color: #1e293b;
    font-size: 1.4em;
    font-weight: 600;
    margin-top: 30px;
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 2px solid #e2e8f0;
}

.analysis-section {
    color: #2563eb;
    font-size: 1.2em;
    font-weight: 600;
    margin-top: 25px;
    margin-bottom: 12px;
}

.analysis-point {
    margin: 8px 0;
    margin-left: 20px;
    color: #475569;
    position: relative;
}

.analysis-point::before {
    content: "•";
    color: #64748b;
    position: absolute;
    left: -15px;
}

.evidence-section {
    background-color: #f1f5f9;
    padding: 12px;
    border-radius: 6px;
    margin: 15px 0;
    border-left: 3px solid #64748b;
    font-size: 0.95em;
}

.evidence-section strong {
    color: #334155;
}

/* Completely override any inherited list styling */
.detailed-analysis-content * {
    list-style: none !important;
    list-style-type: none !important;
}

.detailed-analysis-content p {
    margin-bottom: 8px;
    color: #475569;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab functionality
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            // Remove active class from all tabs and contents
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            // Add active class to clicked tab and corresponding content
            tab.classList.add('active');
            const tabId = tab.getAttribute('data-tab');
            const targetContent = document.getElementById(tabId);
            if (targetContent) {
                targetContent.classList.add('active');
            }
        });
    });
});
</script>
{% endblock %}