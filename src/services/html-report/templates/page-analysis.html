{% extends "base.html" %}

{% block content %}
<h1>{{ page_type }} - Detailed Analysis</h1>

<div class="info-grid">
    <div class="info-card">
        <div class="info-label">Page Type</div>
        <div class="info-value">{{ page_type }}</div>
    </div>
    <div class="info-card">
        <div class="info-label">Page URL</div>
        <div class="info-value" style="word-break: break-all;">{{ page_url }}</div>
    </div>
    <div class="info-card">
        <div class="info-label">Overall Score</div>
        <div class="info-value {% if page_analysis.overall_score >= 8 %}good{% elif page_analysis.overall_score >= 6 %}average{% else %}poor{% endif %}">
            {{ page_analysis.overall_score }}/10
        </div>
    </div>
    <div class="info-card">
        <div class="info-label">Analysis Date</div>
        <div class="info-value">{{ analysis_date }}</div>
    </div>
</div>

<!-- Page Summary -->
<div class="section">
    <h2>Page Summary</h2>
    <div class="analysis-result">
        <p style="font-size: 1.1em; line-height: 1.7; background-color: #f0fdf4; padding: 15px; border-radius: 6px; border-left: 4px solid #10b981;">
            {{ page_analysis.summary }}
        </p>
    </div>
</div>

<!-- Screenshot -->
<div class="section">
    <h2>Page Screenshot</h2>
    <div class="screenshot-container">
        <img src="../screenshots/{{ screenshot_path }}" alt="{{ page_type }}" class="screenshot" 
             style="max-width: 100%; border: 2px solid #e2e8f0; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
    </div>
</div>

<!-- Tab navigation -->
<div class="tabs">
    <div class="tab active" data-tab="tab-detailed">Detailed Analysis</div>
    <div class="tab" data-tab="tab-issues">Key Issues</div>
    <div class="tab" data-tab="tab-recommendations">Recommendations</div>
    <div class="tab" data-tab="tab-full">Complete Raw Analysis</div>
</div>

<!-- Detailed Analysis Tab -->
<div id="tab-detailed" class="tab-content active">
    <div class="section">
        <h2>Comprehensive Page Analysis</h2>
        {% if page_analysis.full_analysis %}
        <div class="analysis-result">
            <div style="white-space: pre-line; line-height: 1.6; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                {{ page_analysis.full_analysis | replace('# ', '<h3>') | replace('## ', '<h4>') | replace('### ', '<h5>') | replace('**', '<strong>') | replace('**', '</strong>') | safe }}
            </div>
        </div>
        {% else %}
        <p>No detailed analysis available for this page.</p>
        {% endif %}
    </div>
</div>

<!-- Key Issues Tab -->
<div id="tab-issues" class="tab-content">
    {% if page_analysis.critical_flaws and page_analysis.critical_flaws.length > 0 %}
    <div class="section">
        <h2>Key Issues Identified</h2>
        {% for flaw in page_analysis.critical_flaws %}
        <div class="critical-issue" style="margin-bottom: 15px;">
            <strong>{{ loop.index }}.</strong> {{ flaw }}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="section">
        <div style="padding: 20px; background-color: #f0fdf4; border-radius: 6px; border-left: 4px solid #10b981;">
            <p><strong>✅ No critical issues identified</strong></p>
            <p>This page appears to be functioning well without major usability or conversion problems.</p>
        </div>
    </div>
    {% endif %}
</div>

<!-- Recommendations Tab -->
<div id="tab-recommendations" class="tab-content">
    {% if page_analysis.recommendations and page_analysis.recommendations.length > 0 %}
    <div class="section">
        <h2>Recommended Improvements</h2>
        {% for recommendation in page_analysis.recommendations %}
        <div class="recommendation" style="margin-bottom: 15px;">
            <strong>{{ loop.index }}.</strong> {{ recommendation }}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="section">
        <p>No specific recommendations were provided for this page.</p>
    </div>
    {% endif %}
</div>

<!-- Raw Analysis Tab -->
<div id="tab-full" class="tab-content">
    <div class="section">
        <h2>Complete Raw Analysis Data</h2>
        {% if page_analysis.full_analysis %}
        <div class="analysis-result">
            <pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f8f9fa; padding: 20px; border-radius: 6px; border: 1px solid #e9ecef; font-size: 0.9em; line-height: 1.4;">{{ page_analysis.full_analysis }}</pre>
        </div>
        {% else %}
        <p>No raw analysis data available for this page.</p>
        {% endif %}
    </div>
</div>

<div class="navigation" style="margin-top: 30px;">
    <a href="index.html">← Back to All Pages</a>
    <a href="../index.html">← Overall Analysis</a>
</div>

<style>
.analysis-result h3 {
    color: #2563eb;
    margin-top: 25px;
    margin-bottom: 10px;
    font-size: 1.3em;
    border-bottom: 2px solid #e2e8f0;
    padding-bottom: 5px;
}

.analysis-result h4 {
    color: #1e40af;
    margin-top: 20px;
    margin-bottom: 8px;
    font-size: 1.2em;
}

.analysis-result h5 {
    color: #1e3a8a;
    margin-top: 15px;
    margin-bottom: 6px;
    font-size: 1.1em;
}

.critical-issue {
    background-color: #fff5f7;
    border-left: 4px solid #ef4444;
    padding: 15px;
    border-radius: 4px;
}

.recommendation {
    background-color: #f0fdf4;
    border-left: 4px solid #10b981;
    padding: 15px;
    border-radius: 4px;
}
</style>
{% endblock %}