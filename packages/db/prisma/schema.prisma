generator client {
  provider = "prisma-client-js"
}

// Switched from sqlite to postgresql
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") // Uses the .env file
}

model User {
  id           Int      @id @default(autoincrement())
  fullName     String?
  email        String   @unique
  passwordHash String
  createdAt    DateTime @default(now())
  projects     Project[]
}

model Project {
  id           Int           @id @default(autoincrement())
  userId       Int
  name         String
  baseUrl      String
  orgName      String?
  orgPurpose   String?
  createdAt    DateTime      @default(now())
  user         User          @relation(fields: [userId], references: [id])
  analysisRuns AnalysisRun[]
}

model AnalysisRun {
  id            Int      @id @default(autoincrement())
  projectId     Int
  status        String
  progress      Json?    // Changed back to Json
  finalReport   Json?    // Changed back to Json
  overallScore  Int?
  createdAt     DateTime @default(now())
  project       Project  @relation(fields: [projectId], references: [id])
  analyzedPages AnalyzedPage[]
}

model AnalyzedPage {
  id            Int      @id @default(autoincrement())
  runId         Int
  url           String
  screenshotUrl String?
  pageAim       String?
  analysisRun   AnalysisRun @relation(fields: [runId], references: [id])
}